<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (16) -->
<title>Source code</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="source: module: org.hdfgroup.hdfview, package: hdf.view, class: Chart">
<meta name="generator" content="javadoc/SourceToHTMLConverter">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
</head>
<body class="source-page">
<main role="main">
<div class="source-container">
<pre><span class="source-line-no">001</span><span id="line.1">/*****************************************************************************</span>
<span class="source-line-no">002</span><span id="line.2"> * Copyright by The HDF Group.                                               *</span>
<span class="source-line-no">003</span><span id="line.3"> * Copyright by the Board of Trustees of the University of Illinois.         *</span>
<span class="source-line-no">004</span><span id="line.4"> * All rights reserved.                                                      *</span>
<span class="source-line-no">005</span><span id="line.5"> *                                                                           *</span>
<span class="source-line-no">006</span><span id="line.6"> * This file is part of the HDF Java Products distribution.                  *</span>
<span class="source-line-no">007</span><span id="line.7"> * The full copyright notice, including terms governing use, modification,   *</span>
<span class="source-line-no">008</span><span id="line.8"> * and redistribution, is contained in the files COPYING and Copyright.html. *</span>
<span class="source-line-no">009</span><span id="line.9"> * COPYING can be found at the root of the source code distribution tree.    *</span>
<span class="source-line-no">010</span><span id="line.10"> * Or, see https://support.hdfgroup.org/products/licenses.html               *</span>
<span class="source-line-no">011</span><span id="line.11"> * If you do not have access to either file, you may request a copy from     *</span>
<span class="source-line-no">012</span><span id="line.12"> * help@hdfgroup.org.                                                        *</span>
<span class="source-line-no">013</span><span id="line.13"> ****************************************************************************/</span>
<span class="source-line-no">014</span><span id="line.14"></span>
<span class="source-line-no">015</span><span id="line.15">package hdf.view;</span>
<span class="source-line-no">016</span><span id="line.16"></span>
<span class="source-line-no">017</span><span id="line.17">import java.lang.reflect.Array;</span>
<span class="source-line-no">018</span><span id="line.18"></span>
<span class="source-line-no">019</span><span id="line.19">import org.eclipse.swt.SWT;</span>
<span class="source-line-no">020</span><span id="line.20">import org.eclipse.swt.events.DisposeEvent;</span>
<span class="source-line-no">021</span><span id="line.21">import org.eclipse.swt.events.DisposeListener;</span>
<span class="source-line-no">022</span><span id="line.22">import org.eclipse.swt.events.PaintEvent;</span>
<span class="source-line-no">023</span><span id="line.23">import org.eclipse.swt.events.PaintListener;</span>
<span class="source-line-no">024</span><span id="line.24">import org.eclipse.swt.events.SelectionAdapter;</span>
<span class="source-line-no">025</span><span id="line.25">import org.eclipse.swt.events.SelectionEvent;</span>
<span class="source-line-no">026</span><span id="line.26">import org.eclipse.swt.graphics.Color;</span>
<span class="source-line-no">027</span><span id="line.27">import org.eclipse.swt.graphics.Font;</span>
<span class="source-line-no">028</span><span id="line.28">import org.eclipse.swt.graphics.GC;</span>
<span class="source-line-no">029</span><span id="line.29">import org.eclipse.swt.graphics.Point;</span>
<span class="source-line-no">030</span><span id="line.30">import org.eclipse.swt.graphics.RGB;</span>
<span class="source-line-no">031</span><span id="line.31">import org.eclipse.swt.graphics.Rectangle;</span>
<span class="source-line-no">032</span><span id="line.32">import org.eclipse.swt.layout.GridData;</span>
<span class="source-line-no">033</span><span id="line.33">import org.eclipse.swt.layout.GridLayout;</span>
<span class="source-line-no">034</span><span id="line.34">import org.eclipse.swt.widgets.Button;</span>
<span class="source-line-no">035</span><span id="line.35">import org.eclipse.swt.widgets.Canvas;</span>
<span class="source-line-no">036</span><span id="line.36">import org.eclipse.swt.widgets.ColorDialog;</span>
<span class="source-line-no">037</span><span id="line.37">import org.eclipse.swt.widgets.Composite;</span>
<span class="source-line-no">038</span><span id="line.38">import org.eclipse.swt.widgets.Dialog;</span>
<span class="source-line-no">039</span><span id="line.39">import org.eclipse.swt.widgets.Display;</span>
<span class="source-line-no">040</span><span id="line.40">import org.eclipse.swt.widgets.Menu;</span>
<span class="source-line-no">041</span><span id="line.41">import org.eclipse.swt.widgets.MenuItem;</span>
<span class="source-line-no">042</span><span id="line.42">import org.eclipse.swt.widgets.Shell;</span>
<span class="source-line-no">043</span><span id="line.43"></span>
<span class="source-line-no">044</span><span id="line.44">/**</span>
<span class="source-line-no">045</span><span id="line.45"> * ChartView displays a histogram/line chart of selected row/column of table data</span>
<span class="source-line-no">046</span><span id="line.46"> * or image data. There are two types of chart, histogram and line plot.</span>
<span class="source-line-no">047</span><span id="line.47"> *</span>
<span class="source-line-no">048</span><span id="line.48"> * @author Jordan T. Henderson</span>
<span class="source-line-no">049</span><span id="line.49"> * @version 2.4 2/27/16</span>
<span class="source-line-no">050</span><span id="line.50"> */</span>
<span class="source-line-no">051</span><span id="line.51">public class Chart extends Dialog</span>
<span class="source-line-no">052</span><span id="line.52">{</span>
<span class="source-line-no">053</span><span id="line.53">    private Shell                       shell;</span>
<span class="source-line-no">054</span><span id="line.54"></span>
<span class="source-line-no">055</span><span id="line.55">    private Font                        curFont;</span>
<span class="source-line-no">056</span><span id="line.56"></span>
<span class="source-line-no">057</span><span id="line.57">    private String                      windowTitle;</span>
<span class="source-line-no">058</span><span id="line.58"></span>
<span class="source-line-no">059</span><span id="line.59">    private Color                       barColor;</span>
<span class="source-line-no">060</span><span id="line.60"></span>
<span class="source-line-no">061</span><span id="line.61">    /** histogram style chart */</span>
<span class="source-line-no">062</span><span id="line.62">    public static final int             HISTOGRAM = 0;</span>
<span class="source-line-no">063</span><span id="line.63"></span>
<span class="source-line-no">064</span><span id="line.64">    /** line style chart */</span>
<span class="source-line-no">065</span><span id="line.65">    public static final int             LINEPLOT = 1;</span>
<span class="source-line-no">066</span><span id="line.66"></span>
<span class="source-line-no">067</span><span id="line.67">    /** The default colors of lines for selected columns */</span>
<span class="source-line-no">068</span><span id="line.68">    public static final int[]           LINE_COLORS = { SWT.COLOR_BLACK, SWT.COLOR_RED,</span>
<span class="source-line-no">069</span><span id="line.69">            SWT.COLOR_DARK_GREEN, SWT.COLOR_BLUE, SWT.COLOR_MAGENTA, /*Pink*/</span>
<span class="source-line-no">070</span><span id="line.70">            SWT.COLOR_YELLOW, /*Orange*/ SWT.COLOR_GRAY, SWT.COLOR_CYAN };</span>
<span class="source-line-no">071</span><span id="line.71"></span>
<span class="source-line-no">072</span><span id="line.72">    /** the data values of line points or histogram */</span>
<span class="source-line-no">073</span><span id="line.73">    protected double                    data[][];</span>
<span class="source-line-no">074</span><span id="line.74"></span>
<span class="source-line-no">075</span><span id="line.75">    /** Panel that draws plot of data values. */</span>
<span class="source-line-no">076</span><span id="line.76">    protected ChartCanvas               chartP;</span>
<span class="source-line-no">077</span><span id="line.77"></span>
<span class="source-line-no">078</span><span id="line.78">    /** number of data points */</span>
<span class="source-line-no">079</span><span id="line.79">    protected int                       numberOfPoints;</span>
<span class="source-line-no">080</span><span id="line.80"></span>
<span class="source-line-no">081</span><span id="line.81">    /** the style of chart: histogram or line */</span>
<span class="source-line-no">082</span><span id="line.82">    private int                         chartStyle;</span>
<span class="source-line-no">083</span><span id="line.83"></span>
<span class="source-line-no">084</span><span id="line.84">    /** the maximum value of the Y axis */</span>
<span class="source-line-no">085</span><span id="line.85">    private double                      ymax;</span>
<span class="source-line-no">086</span><span id="line.86"></span>
<span class="source-line-no">087</span><span id="line.87">    /** the minimum value of the Y axis */</span>
<span class="source-line-no">088</span><span id="line.88">    private double                      ymin;</span>
<span class="source-line-no">089</span><span id="line.89"></span>
<span class="source-line-no">090</span><span id="line.90">    /** the maximum value of the X axis */</span>
<span class="source-line-no">091</span><span id="line.91">    private double                      xmax;</span>
<span class="source-line-no">092</span><span id="line.92"></span>
<span class="source-line-no">093</span><span id="line.93">    /** the minimum value of the X axis */</span>
<span class="source-line-no">094</span><span id="line.94">    private double                      xmin;</span>
<span class="source-line-no">095</span><span id="line.95"></span>
<span class="source-line-no">096</span><span id="line.96">    /** line labels */</span>
<span class="source-line-no">097</span><span id="line.97">    private String[]                    lineLabels;</span>
<span class="source-line-no">098</span><span id="line.98"></span>
<span class="source-line-no">099</span><span id="line.99">    /** line colors */</span>
<span class="source-line-no">100</span><span id="line.100">    private int[]                       lineColors;</span>
<span class="source-line-no">101</span><span id="line.101"></span>
<span class="source-line-no">102</span><span id="line.102">    /** number of lines */</span>
<span class="source-line-no">103</span><span id="line.103">    private int                         numberOfLines;</span>
<span class="source-line-no">104</span><span id="line.104"></span>
<span class="source-line-no">105</span><span id="line.105">    /** the data to plot against **/</span>
<span class="source-line-no">106</span><span id="line.106">    private double[]                    xData = null;</span>
<span class="source-line-no">107</span><span id="line.107"></span>
<span class="source-line-no">108</span><span id="line.108">    /**</span>
<span class="source-line-no">109</span><span id="line.109">    * True if the original data is integer (byte, short, integer, long).</span>
<span class="source-line-no">110</span><span id="line.110">    */</span>
<span class="source-line-no">111</span><span id="line.111">    private boolean                     isInteger;</span>
<span class="source-line-no">112</span><span id="line.112"></span>
<span class="source-line-no">113</span><span id="line.113">    private java.text.DecimalFormat     format;</span>
<span class="source-line-no">114</span><span id="line.114"></span>
<span class="source-line-no">115</span><span id="line.115">    /**</span>
<span class="source-line-no">116</span><span id="line.116">    * Constructs a new ChartView given data and data ranges.</span>
<span class="source-line-no">117</span><span id="line.117">    *</span>
<span class="source-line-no">118</span><span id="line.118">    * @param parent</span>
<span class="source-line-no">119</span><span id="line.119">    *            the parent of this dialog.</span>
<span class="source-line-no">120</span><span id="line.120">    * @param title</span>
<span class="source-line-no">121</span><span id="line.121">    *            the title of this dialog.</span>
<span class="source-line-no">122</span><span id="line.122">    * @param style</span>
<span class="source-line-no">123</span><span id="line.123">    *            the style of the chart. Valid values are: HISTOGRAM and LINE</span>
<span class="source-line-no">124</span><span id="line.124">    * @param data</span>
<span class="source-line-no">125</span><span id="line.125">    *            the two dimensional data array: data[linenumber][datapoints]</span>
<span class="source-line-no">126</span><span id="line.126">    * @param xData</span>
<span class="source-line-no">127</span><span id="line.127">    *            the range of the X values, xRange[0]=xmin, xRange[1]=xmax.</span>
<span class="source-line-no">128</span><span id="line.128">    * @param yRange</span>
<span class="source-line-no">129</span><span id="line.129">    *            the range of the Y values, yRange[0]=ymin, yRange[1]=ymax.</span>
<span class="source-line-no">130</span><span id="line.130">    */</span>
<span class="source-line-no">131</span><span id="line.131">    public Chart(Shell parent, String title, int style, double[][] data, double[] xData, double[] yRange) {</span>
<span class="source-line-no">132</span><span id="line.132">        super(parent, style);</span>
<span class="source-line-no">133</span><span id="line.133"></span>
<span class="source-line-no">134</span><span id="line.134">        if (data == null)</span>
<span class="source-line-no">135</span><span id="line.135">            return;</span>
<span class="source-line-no">136</span><span id="line.136"></span>
<span class="source-line-no">137</span><span id="line.137">        this.windowTitle = title;</span>
<span class="source-line-no">138</span><span id="line.138"></span>
<span class="source-line-no">139</span><span id="line.139">        try {</span>
<span class="source-line-no">140</span><span id="line.140">            curFont = new Font(</span>
<span class="source-line-no">141</span><span id="line.141">                    Display.getCurrent(),</span>
<span class="source-line-no">142</span><span id="line.142">                    ViewProperties.getFontType(),</span>
<span class="source-line-no">143</span><span id="line.143">                    ViewProperties.getFontSize(),</span>
<span class="source-line-no">144</span><span id="line.144">                    SWT.NORMAL);</span>
<span class="source-line-no">145</span><span id="line.145">        }</span>
<span class="source-line-no">146</span><span id="line.146">        catch (Exception ex) {</span>
<span class="source-line-no">147</span><span id="line.147">            curFont = null;</span>
<span class="source-line-no">148</span><span id="line.148">        }</span>
<span class="source-line-no">149</span><span id="line.149"></span>
<span class="source-line-no">150</span><span id="line.150">        format = new java.text.DecimalFormat("0.00E0");</span>
<span class="source-line-no">151</span><span id="line.151">        this.chartStyle = style;</span>
<span class="source-line-no">152</span><span id="line.152">        this.data = data;</span>
<span class="source-line-no">153</span><span id="line.153"></span>
<span class="source-line-no">154</span><span id="line.154">        if (style == HISTOGRAM) {</span>
<span class="source-line-no">155</span><span id="line.155">            isInteger = true;</span>
<span class="source-line-no">156</span><span id="line.156">            barColor = new Color(Display.getDefault(), new RGB(0, 0, 255));</span>
<span class="source-line-no">157</span><span id="line.157">        }</span>
<span class="source-line-no">158</span><span id="line.158">        else {</span>
<span class="source-line-no">159</span><span id="line.159">            isInteger = false;</span>
<span class="source-line-no">160</span><span id="line.160">        }</span>
<span class="source-line-no">161</span><span id="line.161"></span>
<span class="source-line-no">162</span><span id="line.162">        if (xData != null) {</span>
<span class="source-line-no">163</span><span id="line.163">            int len = xData.length;</span>
<span class="source-line-no">164</span><span id="line.164">            if (len == 2) {</span>
<span class="source-line-no">165</span><span id="line.165">                this.xmin = xData[0];</span>
<span class="source-line-no">166</span><span id="line.166">                this.xmax = xData[1];</span>
<span class="source-line-no">167</span><span id="line.167">            }</span>
<span class="source-line-no">168</span><span id="line.168">            else {</span>
<span class="source-line-no">169</span><span id="line.169">                this.xData = xData;</span>
<span class="source-line-no">170</span><span id="line.170">                xmin = xmax = xData[0];</span>
<span class="source-line-no">171</span><span id="line.171">                for (int i = 0; i &lt; len; i++) {</span>
<span class="source-line-no">172</span><span id="line.172">                    if (xData[i] &lt; xmin)</span>
<span class="source-line-no">173</span><span id="line.173">                        xmin = xData[i];</span>
<span class="source-line-no">174</span><span id="line.174"></span>
<span class="source-line-no">175</span><span id="line.175">                    if (xData[i] &gt; xmax)</span>
<span class="source-line-no">176</span><span id="line.176">                        xmax = xData[i];</span>
<span class="source-line-no">177</span><span id="line.177">                }</span>
<span class="source-line-no">178</span><span id="line.178">            }</span>
<span class="source-line-no">179</span><span id="line.179">        }</span>
<span class="source-line-no">180</span><span id="line.180">        else {</span>
<span class="source-line-no">181</span><span id="line.181">            this.xmin = 1;</span>
<span class="source-line-no">182</span><span id="line.182">            this.xmax = data[0].length;</span>
<span class="source-line-no">183</span><span id="line.183">        }</span>
<span class="source-line-no">184</span><span id="line.184"></span>
<span class="source-line-no">185</span><span id="line.185">        this.numberOfLines = Array.getLength(data);</span>
<span class="source-line-no">186</span><span id="line.186">        this.numberOfPoints = Array.getLength(data[0]);</span>
<span class="source-line-no">187</span><span id="line.187">        this.lineColors = LINE_COLORS;</span>
<span class="source-line-no">188</span><span id="line.188"></span>
<span class="source-line-no">189</span><span id="line.189">        if (yRange != null) {</span>
<span class="source-line-no">190</span><span id="line.190">            // data range is given</span>
<span class="source-line-no">191</span><span id="line.191">            this.ymin = yRange[0];</span>
<span class="source-line-no">192</span><span id="line.192">            this.ymax = yRange[1];</span>
<span class="source-line-no">193</span><span id="line.193">        }</span>
<span class="source-line-no">194</span><span id="line.194">        else {</span>
<span class="source-line-no">195</span><span id="line.195">            // search data range from the data</span>
<span class="source-line-no">196</span><span id="line.196">            findDataRange();</span>
<span class="source-line-no">197</span><span id="line.197">        }</span>
<span class="source-line-no">198</span><span id="line.198"></span>
<span class="source-line-no">199</span><span id="line.199">        if ((ymax &lt; 0.0001) || (ymax &gt; 100000))</span>
<span class="source-line-no">200</span><span id="line.200">            format = new java.text.DecimalFormat("###.####E0#");</span>
<span class="source-line-no">201</span><span id="line.201">    }</span>
<span class="source-line-no">202</span><span id="line.202"></span>
<span class="source-line-no">203</span><span id="line.203">    /** Show the Chart dialog. */</span>
<span class="source-line-no">204</span><span id="line.204">    public void open() {</span>
<span class="source-line-no">205</span><span id="line.205">        Shell parent = getParent();</span>
<span class="source-line-no">206</span><span id="line.206">        shell = new Shell(parent, SWT.SHELL_TRIM);</span>
<span class="source-line-no">207</span><span id="line.207">        shell.setFont(curFont);</span>
<span class="source-line-no">208</span><span id="line.208">        shell.setText(windowTitle);</span>
<span class="source-line-no">209</span><span id="line.209">        shell.setImage(ViewProperties.getHdfIcon());</span>
<span class="source-line-no">210</span><span id="line.210">        shell.setLayout(new GridLayout(1, true));</span>
<span class="source-line-no">211</span><span id="line.211"></span>
<span class="source-line-no">212</span><span id="line.212">        if (chartStyle == HISTOGRAM)</span>
<span class="source-line-no">213</span><span id="line.213">            shell.setMenuBar(createMenuBar(shell));</span>
<span class="source-line-no">214</span><span id="line.214"></span>
<span class="source-line-no">215</span><span id="line.215">        shell.addDisposeListener(new DisposeListener() {</span>
<span class="source-line-no">216</span><span id="line.216">            public void widgetDisposed(DisposeEvent e) {</span>
<span class="source-line-no">217</span><span id="line.217">                if (curFont != null)</span>
<span class="source-line-no">218</span><span id="line.218">                    curFont.dispose();</span>
<span class="source-line-no">219</span><span id="line.219">                if (barColor != null)</span>
<span class="source-line-no">220</span><span id="line.220">                    barColor.dispose();</span>
<span class="source-line-no">221</span><span id="line.221">            }</span>
<span class="source-line-no">222</span><span id="line.222">        });</span>
<span class="source-line-no">223</span><span id="line.223"></span>
<span class="source-line-no">224</span><span id="line.224">        chartP = new ChartCanvas(shell, SWT.DOUBLE_BUFFERED | SWT.BORDER);</span>
<span class="source-line-no">225</span><span id="line.225">        chartP.setBackground(Display.getCurrent().getSystemColor(SWT.COLOR_WHITE));</span>
<span class="source-line-no">226</span><span id="line.226">        chartP.setLayoutData(new GridData(SWT.FILL, SWT.FILL, true, true));</span>
<span class="source-line-no">227</span><span id="line.227"></span>
<span class="source-line-no">228</span><span id="line.228"></span>
<span class="source-line-no">229</span><span id="line.229">        // Add close button</span>
<span class="source-line-no">230</span><span id="line.230">        Composite buttonComposite = new Composite(shell, SWT.NONE);</span>
<span class="source-line-no">231</span><span id="line.231">        buttonComposite.setLayout(new GridLayout(1, true));</span>
<span class="source-line-no">232</span><span id="line.232">        buttonComposite.setLayoutData(new GridData(SWT.CENTER, SWT.FILL, true, false));</span>
<span class="source-line-no">233</span><span id="line.233"></span>
<span class="source-line-no">234</span><span id="line.234">        Button closeButton = new Button(buttonComposite, SWT.PUSH);</span>
<span class="source-line-no">235</span><span id="line.235">        closeButton.setFont(curFont);</span>
<span class="source-line-no">236</span><span id="line.236">        closeButton.setText("   &amp;Close   ");</span>
<span class="source-line-no">237</span><span id="line.237">        closeButton.setLayoutData(new GridData(SWT.CENTER, SWT.FILL, false, false));</span>
<span class="source-line-no">238</span><span id="line.238">        closeButton.addSelectionListener(new SelectionAdapter() {</span>
<span class="source-line-no">239</span><span id="line.239">            public void widgetSelected(SelectionEvent e) {</span>
<span class="source-line-no">240</span><span id="line.240">                shell.dispose();</span>
<span class="source-line-no">241</span><span id="line.241">            }</span>
<span class="source-line-no">242</span><span id="line.242">        });</span>
<span class="source-line-no">243</span><span id="line.243"></span>
<span class="source-line-no">244</span><span id="line.244">        shell.pack();</span>
<span class="source-line-no">245</span><span id="line.245"></span>
<span class="source-line-no">246</span><span id="line.246">        int w = 640 + (ViewProperties.getFontSize() - 12) * 15;</span>
<span class="source-line-no">247</span><span id="line.247">        int h = 400 + (ViewProperties.getFontSize() - 12) * 10;</span>
<span class="source-line-no">248</span><span id="line.248"></span>
<span class="source-line-no">249</span><span id="line.249">        shell.setMinimumSize(w, h);</span>
<span class="source-line-no">250</span><span id="line.250"></span>
<span class="source-line-no">251</span><span id="line.251">        Rectangle parentBounds = parent.getBounds();</span>
<span class="source-line-no">252</span><span id="line.252">        Point shellSize = shell.getSize();</span>
<span class="source-line-no">253</span><span id="line.253">        shell.setLocation((parentBounds.x + (parentBounds.width / 2)) - (shellSize.x / 2),</span>
<span class="source-line-no">254</span><span id="line.254">                (parentBounds.y + (parentBounds.height / 2)) - (shellSize.y / 2));</span>
<span class="source-line-no">255</span><span id="line.255"></span>
<span class="source-line-no">256</span><span id="line.256">        shell.open();</span>
<span class="source-line-no">257</span><span id="line.257">    }</span>
<span class="source-line-no">258</span><span id="line.258"></span>
<span class="source-line-no">259</span><span id="line.259">    private Menu createMenuBar(Shell parent) {</span>
<span class="source-line-no">260</span><span id="line.260">        Menu menu = new Menu(parent, SWT.BAR);</span>
<span class="source-line-no">261</span><span id="line.261"></span>
<span class="source-line-no">262</span><span id="line.262">        MenuItem item = new MenuItem(menu, SWT.CASCADE);</span>
<span class="source-line-no">263</span><span id="line.263">        item.setText("Histogram");</span>
<span class="source-line-no">264</span><span id="line.264"></span>
<span class="source-line-no">265</span><span id="line.265">        Menu histogramMenu = new Menu(item);</span>
<span class="source-line-no">266</span><span id="line.266">        item.setMenu(histogramMenu);</span>
<span class="source-line-no">267</span><span id="line.267"></span>
<span class="source-line-no">268</span><span id="line.268">        MenuItem setColor = new MenuItem(histogramMenu, SWT.PUSH);</span>
<span class="source-line-no">269</span><span id="line.269">        setColor.setText("Change bar color");</span>
<span class="source-line-no">270</span><span id="line.270">        setColor.addSelectionListener(new SelectionAdapter() {</span>
<span class="source-line-no">271</span><span id="line.271">            public void widgetSelected(SelectionEvent e) {</span>
<span class="source-line-no">272</span><span id="line.272">                ColorDialog dialog = new ColorDialog(shell);</span>
<span class="source-line-no">273</span><span id="line.273">                dialog.setRGB(barColor.getRGB());</span>
<span class="source-line-no">274</span><span id="line.274">                dialog.setText("Select a bar color");</span>
<span class="source-line-no">275</span><span id="line.275"></span>
<span class="source-line-no">276</span><span id="line.276">                RGB newColor = dialog.open();</span>
<span class="source-line-no">277</span><span id="line.277"></span>
<span class="source-line-no">278</span><span id="line.278">                if (newColor != null) {</span>
<span class="source-line-no">279</span><span id="line.279">                    barColor.dispose();</span>
<span class="source-line-no">280</span><span id="line.280">                    barColor = new Color(Display.getDefault(), newColor);</span>
<span class="source-line-no">281</span><span id="line.281">                    chartP.redraw();</span>
<span class="source-line-no">282</span><span id="line.282">                }</span>
<span class="source-line-no">283</span><span id="line.283">            }</span>
<span class="source-line-no">284</span><span id="line.284">        });</span>
<span class="source-line-no">285</span><span id="line.285"></span>
<span class="source-line-no">286</span><span id="line.286">        new MenuItem(histogramMenu, SWT.SEPARATOR);</span>
<span class="source-line-no">287</span><span id="line.287"></span>
<span class="source-line-no">288</span><span id="line.288">        MenuItem close = new MenuItem(histogramMenu, SWT.PUSH);</span>
<span class="source-line-no">289</span><span id="line.289">        close.setText("Close");</span>
<span class="source-line-no">290</span><span id="line.290">        close.addSelectionListener(new SelectionAdapter() {</span>
<span class="source-line-no">291</span><span id="line.291">            public void widgetSelected(SelectionEvent e) {</span>
<span class="source-line-no">292</span><span id="line.292">                shell.dispose();</span>
<span class="source-line-no">293</span><span id="line.293">            }</span>
<span class="source-line-no">294</span><span id="line.294">        });</span>
<span class="source-line-no">295</span><span id="line.295"></span>
<span class="source-line-no">296</span><span id="line.296">        return menu;</span>
<span class="source-line-no">297</span><span id="line.297">    }</span>
<span class="source-line-no">298</span><span id="line.298"></span>
<span class="source-line-no">299</span><span id="line.299">    /** Sets the color of each line of a line plot</span>
<span class="source-line-no">300</span><span id="line.300">    *</span>
<span class="source-line-no">301</span><span id="line.301">    * @param c the list of colors</span>
<span class="source-line-no">302</span><span id="line.302">    */</span>
<span class="source-line-no">303</span><span id="line.303">    public void setLineColors(int[] c) {</span>
<span class="source-line-no">304</span><span id="line.304">        lineColors = c;</span>
<span class="source-line-no">305</span><span id="line.305">    }</span>
<span class="source-line-no">306</span><span id="line.306"></span>
<span class="source-line-no">307</span><span id="line.307">    /** Sets the labels of each line.</span>
<span class="source-line-no">308</span><span id="line.308">    *</span>
<span class="source-line-no">309</span><span id="line.309">    * @param l the list of line labels</span>
<span class="source-line-no">310</span><span id="line.310">    */</span>
<span class="source-line-no">311</span><span id="line.311">    public void setLineLabels(String[] l) {</span>
<span class="source-line-no">312</span><span id="line.312">        lineLabels = l;</span>
<span class="source-line-no">313</span><span id="line.313">    }</span>
<span class="source-line-no">314</span><span id="line.314"></span>
<span class="source-line-no">315</span><span id="line.315">    /** Sets the data type of the plot data to be integer. */</span>
<span class="source-line-no">316</span><span id="line.316">    public void setTypeToInteger() {</span>
<span class="source-line-no">317</span><span id="line.317">        isInteger = true;</span>
<span class="source-line-no">318</span><span id="line.318">    }</span>
<span class="source-line-no">319</span><span id="line.319"></span>
<span class="source-line-no">320</span><span id="line.320">    /** Find and set the minimum and maximum values of the data */</span>
<span class="source-line-no">321</span><span id="line.321">    private void findDataRange() {</span>
<span class="source-line-no">322</span><span id="line.322">        if (data == null)</span>
<span class="source-line-no">323</span><span id="line.323">            return;</span>
<span class="source-line-no">324</span><span id="line.324"></span>
<span class="source-line-no">325</span><span id="line.325">        ymin = ymax = data[0][0];</span>
<span class="source-line-no">326</span><span id="line.326">        for (int i = 0; i &lt; numberOfLines; i++) {</span>
<span class="source-line-no">327</span><span id="line.327">            for (int j = 0; j &lt; numberOfPoints; j++) {</span>
<span class="source-line-no">328</span><span id="line.328">                if (data[i][j] &lt; ymin)</span>
<span class="source-line-no">329</span><span id="line.329">                    ymin = data[i][j];</span>
<span class="source-line-no">330</span><span id="line.330"></span>
<span class="source-line-no">331</span><span id="line.331">                if (data[i][j] &gt; ymax)</span>
<span class="source-line-no">332</span><span id="line.332">                    ymax = data[i][j];</span>
<span class="source-line-no">333</span><span id="line.333">            }</span>
<span class="source-line-no">334</span><span id="line.334">        }</span>
<span class="source-line-no">335</span><span id="line.335">    }</span>
<span class="source-line-no">336</span><span id="line.336"></span>
<span class="source-line-no">337</span><span id="line.337">    /** The canvas that paints the data lines. */</span>
<span class="source-line-no">338</span><span id="line.338">    private class ChartCanvas extends Canvas</span>
<span class="source-line-no">339</span><span id="line.339">    {</span>
<span class="source-line-no">340</span><span id="line.340">        // Value controlling gap between the sides of the canvas</span>
<span class="source-line-no">341</span><span id="line.341">        // and the drawn elements</span>
<span class="source-line-no">342</span><span id="line.342">        private static final int GAP = 10;</span>
<span class="source-line-no">343</span><span id="line.343"></span>
<span class="source-line-no">344</span><span id="line.344">        // Values controlling the dimensions of the legend for</span>
<span class="source-line-no">345</span><span id="line.345">        // line plots, as well as the gap in between each</span>
<span class="source-line-no">346</span><span id="line.346">        // element displayed in the legend</span>
<span class="source-line-no">347</span><span id="line.347">        private int legendWidth;</span>
<span class="source-line-no">348</span><span id="line.348">        private int legendHeight;</span>
<span class="source-line-no">349</span><span id="line.349"></span>
<span class="source-line-no">350</span><span id="line.350">        private static final int LEGEND_LINE_WIDTH = 10;</span>
<span class="source-line-no">351</span><span id="line.351">        private static final int LEGEND_LINE_GAP = 30;</span>
<span class="source-line-no">352</span><span id="line.352"></span>
<span class="source-line-no">353</span><span id="line.353">        public ChartCanvas(Composite parent, int style) {</span>
<span class="source-line-no">354</span><span id="line.354">            super(parent, style);</span>
<span class="source-line-no">355</span><span id="line.355"></span>
<span class="source-line-no">356</span><span id="line.356">            // Only draw the legend if the Chart type is a line plot</span>
<span class="source-line-no">357</span><span id="line.357">            if ((chartStyle == LINEPLOT) &amp;&amp; (lineLabels != null)) {</span>
<span class="source-line-no">358</span><span id="line.358">                legendWidth = 60;</span>
<span class="source-line-no">359</span><span id="line.359">                legendHeight = (2 * LEGEND_LINE_GAP) + (numberOfLines * LEGEND_LINE_GAP);</span>
<span class="source-line-no">360</span><span id="line.360">            }</span>
<span class="source-line-no">361</span><span id="line.361"></span>
<span class="source-line-no">362</span><span id="line.362">            this.addPaintListener(new PaintListener() {</span>
<span class="source-line-no">363</span><span id="line.363">                public void paintControl(PaintEvent e) {</span>
<span class="source-line-no">364</span><span id="line.364">                    if (numberOfLines &lt;= 0)</span>
<span class="source-line-no">365</span><span id="line.365">                        return;</span>
<span class="source-line-no">366</span><span id="line.366"></span>
<span class="source-line-no">367</span><span id="line.367">                    // Get the graphics context for this paint event</span>
<span class="source-line-no">368</span><span id="line.368">                    GC g = e.gc;</span>
<span class="source-line-no">369</span><span id="line.369"></span>
<span class="source-line-no">370</span><span id="line.370">                    g.setFont(curFont);</span>
<span class="source-line-no">371</span><span id="line.371"></span>
<span class="source-line-no">372</span><span id="line.372">                    Rectangle canvasBounds = getClientArea();</span>
<span class="source-line-no">373</span><span id="line.373">                    Color c = g.getForeground();</span>
<span class="source-line-no">374</span><span id="line.374"></span>
<span class="source-line-no">375</span><span id="line.375">                    // Calculate maximum width needed to draw the y-axis labels</span>
<span class="source-line-no">376</span><span id="line.376">                    int maxYLabelWidth = g.stringExtent(String.valueOf(ymax)).x;</span>
<span class="source-line-no">377</span><span id="line.377"></span>
<span class="source-line-no">378</span><span id="line.378">                    // Calculate maximum height needed to draw the x-axis labels</span>
<span class="source-line-no">379</span><span id="line.379">                    int maxXLabelHeight = g.stringExtent(String.valueOf(xmax)).y;</span>
<span class="source-line-no">380</span><span id="line.380"></span>
<span class="source-line-no">381</span><span id="line.381">                    // Make sure legend width scales with font size and large column values</span>
<span class="source-line-no">382</span><span id="line.382">                    if (lineLabels != null) {</span>
<span class="source-line-no">383</span><span id="line.383">                        for (int i = 0; i &lt; lineLabels.length; i++) {</span>
<span class="source-line-no">384</span><span id="line.384">                            int width = g.stringExtent(lineLabels[i]).x;</span>
<span class="source-line-no">385</span><span id="line.385">                            if (width &gt; (2 * legendWidth / 3) - 10)</span>
<span class="source-line-no">386</span><span id="line.386">                                legendWidth += width;</span>
<span class="source-line-no">387</span><span id="line.387">                        }</span>
<span class="source-line-no">388</span><span id="line.388">                    }</span>
<span class="source-line-no">389</span><span id="line.389"></span>
<span class="source-line-no">390</span><span id="line.390">                    int xgap = maxYLabelWidth + GAP;</span>
<span class="source-line-no">391</span><span id="line.391">                    int ygap = canvasBounds.height - maxXLabelHeight - GAP - 1;</span>
<span class="source-line-no">392</span><span id="line.392">                    int plotHeight = ygap - GAP;</span>
<span class="source-line-no">393</span><span id="line.393">                    int plotWidth = canvasBounds.width - legendWidth - (2 * GAP) - xgap;</span>
<span class="source-line-no">394</span><span id="line.394">                    int xnpoints = Math.min(10, numberOfPoints - 1);</span>
<span class="source-line-no">395</span><span id="line.395">                    int ynpoints = 10;</span>
<span class="source-line-no">396</span><span id="line.396"></span>
<span class="source-line-no">397</span><span id="line.397">                    // draw the X axis</span>
<span class="source-line-no">398</span><span id="line.398">                    g.drawLine(xgap, ygap, xgap + plotWidth, ygap);</span>
<span class="source-line-no">399</span><span id="line.399"></span>
<span class="source-line-no">400</span><span id="line.400">                    // draw the Y axis</span>
<span class="source-line-no">401</span><span id="line.401">                    g.drawLine(xgap, ygap, xgap, GAP);</span>
<span class="source-line-no">402</span><span id="line.402"></span>
<span class="source-line-no">403</span><span id="line.403">                    // draw x labels</span>
<span class="source-line-no">404</span><span id="line.404">                    double xp = 0;</span>
<span class="source-line-no">405</span><span id="line.405">                    double x = xmin;</span>
<span class="source-line-no">406</span><span id="line.406">                    double dw = (double) plotWidth / (double) xnpoints;</span>
<span class="source-line-no">407</span><span id="line.407">                    double dx = (xmax - xmin) / xnpoints;</span>
<span class="source-line-no">408</span><span id="line.408">                    boolean gtOne = (dx &gt;= 1);</span>
<span class="source-line-no">409</span><span id="line.409">                    for (int i = 0; i &lt;= xnpoints; i++) {</span>
<span class="source-line-no">410</span><span id="line.410">                        x = xmin + i * dx;</span>
<span class="source-line-no">411</span><span id="line.411">                        xp = xgap + i * dw;</span>
<span class="source-line-no">412</span><span id="line.412"></span>
<span class="source-line-no">413</span><span id="line.413">                        // Draw a tick mark</span>
<span class="source-line-no">414</span><span id="line.414">                        g.drawLine((int) xp, ygap, (int) xp, ygap - 5);</span>
<span class="source-line-no">415</span><span id="line.415"></span>
<span class="source-line-no">416</span><span id="line.416">                        if (gtOne) {</span>
<span class="source-line-no">417</span><span id="line.417">                            String value = String.valueOf((int) x);</span>
<span class="source-line-no">418</span><span id="line.418">                            Point numberSize = g.stringExtent(value);</span>
<span class="source-line-no">419</span><span id="line.419">                            g.drawString(value, (int) xp - (numberSize.x / 2), canvasBounds.height - numberSize.y);</span>
<span class="source-line-no">420</span><span id="line.420">                        }</span>
<span class="source-line-no">421</span><span id="line.421">                        else {</span>
<span class="source-line-no">422</span><span id="line.422">                            String value = String.valueOf(x);</span>
<span class="source-line-no">423</span><span id="line.423">                            Point numberSize = g.stringExtent(value);</span>
<span class="source-line-no">424</span><span id="line.424">                            g.drawString(value, (int) xp - (numberSize.x / 2), canvasBounds.height - numberSize.y);</span>
<span class="source-line-no">425</span><span id="line.425">                        }</span>
<span class="source-line-no">426</span><span id="line.426">                    }</span>
<span class="source-line-no">427</span><span id="line.427"></span>
<span class="source-line-no">428</span><span id="line.428">                    // draw y labels</span>
<span class="source-line-no">429</span><span id="line.429">                    double yp = 0;</span>
<span class="source-line-no">430</span><span id="line.430">                    double y = ymin;</span>
<span class="source-line-no">431</span><span id="line.431">                    double dh = (double) plotHeight / (double) ynpoints;</span>
<span class="source-line-no">432</span><span id="line.432">                    double dy = (ymax - ymin) / (ynpoints);</span>
<span class="source-line-no">433</span><span id="line.433">                    if (dy &gt; 1)</span>
<span class="source-line-no">434</span><span id="line.434">                        dy = Math.round(dy * 10.0) / 10.0;</span>
<span class="source-line-no">435</span><span id="line.435">                    for (int i = 0; i &lt;= ynpoints; i++) {</span>
<span class="source-line-no">436</span><span id="line.436">                        yp = i * dh;</span>
<span class="source-line-no">437</span><span id="line.437">                        y = i * dy + ymin;</span>
<span class="source-line-no">438</span><span id="line.438"></span>
<span class="source-line-no">439</span><span id="line.439">                        // Draw a tick mark</span>
<span class="source-line-no">440</span><span id="line.440">                        g.drawLine(xgap, ygap - (int) yp, xgap + 5, ygap - (int) yp);</span>
<span class="source-line-no">441</span><span id="line.441"></span>
<span class="source-line-no">442</span><span id="line.442">                        if (isInteger) {</span>
<span class="source-line-no">443</span><span id="line.443">                            String value = String.valueOf((int) y);</span>
<span class="source-line-no">444</span><span id="line.444">                            Point numberSize = g.stringExtent(value);</span>
<span class="source-line-no">445</span><span id="line.445">                            g.drawString(value, 0, ygap - (int) yp - (numberSize.y / 2));</span>
<span class="source-line-no">446</span><span id="line.446">                        }</span>
<span class="source-line-no">447</span><span id="line.447">                        else {</span>
<span class="source-line-no">448</span><span id="line.448">                            String value = format.format(y);</span>
<span class="source-line-no">449</span><span id="line.449">                            Point numberSize = g.stringExtent(value);</span>
<span class="source-line-no">450</span><span id="line.450">                            g.drawString(value, 0, ygap - (int) yp - (numberSize.y / 2));</span>
<span class="source-line-no">451</span><span id="line.451">                        }</span>
<span class="source-line-no">452</span><span id="line.452">                    }</span>
<span class="source-line-no">453</span><span id="line.453"></span>
<span class="source-line-no">454</span><span id="line.454">                    double x0;</span>
<span class="source-line-no">455</span><span id="line.455">                    double y0;</span>
<span class="source-line-no">456</span><span id="line.456">                    double x1;</span>
<span class="source-line-no">457</span><span id="line.457">                    double y1;</span>
<span class="source-line-no">458</span><span id="line.458">                    if (chartStyle == LINEPLOT) {</span>
<span class="source-line-no">459</span><span id="line.459">                        dw = (double) plotWidth / (double) (numberOfPoints - 1);</span>
<span class="source-line-no">460</span><span id="line.460"></span>
<span class="source-line-no">461</span><span id="line.461">                        // use y = a + b* x to calculate pixel positions</span>
<span class="source-line-no">462</span><span id="line.462">                        double b = plotHeight / (ymin - ymax);</span>
<span class="source-line-no">463</span><span id="line.463">                        double a = -b * ymax + GAP;</span>
<span class="source-line-no">464</span><span id="line.464">                        boolean hasXdata = ((xData != null) &amp;&amp; (xData.length &gt;= numberOfPoints));</span>
<span class="source-line-no">465</span><span id="line.465">                        double xRatio = (1 / (xmax - xmin)) * plotWidth;</span>
<span class="source-line-no">466</span><span id="line.466">                        double xD = (xmin / (xmax - xmin)) * plotWidth;</span>
<span class="source-line-no">467</span><span id="line.467"></span>
<span class="source-line-no">468</span><span id="line.468">                        // draw lines for selected spreadsheet columns</span>
<span class="source-line-no">469</span><span id="line.469">                        for (int i = 0; i &lt; numberOfLines; i++) {</span>
<span class="source-line-no">470</span><span id="line.470">                            // Display each line with a unique color for clarity</span>
<span class="source-line-no">471</span><span id="line.471">                            if ((lineColors != null) &amp;&amp; (lineColors.length &gt;= numberOfLines))</span>
<span class="source-line-no">472</span><span id="line.472">                                g.setForeground(Display.getCurrent().getSystemColor(lineColors[i]));</span>
<span class="source-line-no">473</span><span id="line.473"></span>
<span class="source-line-no">474</span><span id="line.474">                            // set up the line data for drawing one line a time</span>
<span class="source-line-no">475</span><span id="line.475">                            if (hasXdata)</span>
<span class="source-line-no">476</span><span id="line.476">                                x0 = xgap + xData[0] * xRatio - xD;</span>
<span class="source-line-no">477</span><span id="line.477">                            else</span>
<span class="source-line-no">478</span><span id="line.478">                                x0 = xgap;</span>
<span class="source-line-no">479</span><span id="line.479">                            y0 = a + b * data[i][0];</span>
<span class="source-line-no">480</span><span id="line.480"></span>
<span class="source-line-no">481</span><span id="line.481">                            for (int j = 1; j &lt; numberOfPoints; j++) {</span>
<span class="source-line-no">482</span><span id="line.482">                                if (hasXdata)</span>
<span class="source-line-no">483</span><span id="line.483">                                    x1 = xgap + xData[j] * xRatio - xD;</span>
<span class="source-line-no">484</span><span id="line.484">                                else</span>
<span class="source-line-no">485</span><span id="line.485">                                    x1 = xgap + j * dw;</span>
<span class="source-line-no">486</span><span id="line.486"></span>
<span class="source-line-no">487</span><span id="line.487">                                y1 = a + b * data[i][j];</span>
<span class="source-line-no">488</span><span id="line.488">                                g.drawLine((int) x0, (int) y0, (int) x1, (int) y1);</span>
<span class="source-line-no">489</span><span id="line.489"></span>
<span class="source-line-no">490</span><span id="line.490">                                x0 = x1;</span>
<span class="source-line-no">491</span><span id="line.491">                                y0 = y1;</span>
<span class="source-line-no">492</span><span id="line.492">                            }</span>
<span class="source-line-no">493</span><span id="line.493"></span>
<span class="source-line-no">494</span><span id="line.494">                            // draw line legend</span>
<span class="source-line-no">495</span><span id="line.495">                            if ((lineLabels != null) &amp;&amp; (lineLabels.length &gt;= numberOfLines)) {</span>
<span class="source-line-no">496</span><span id="line.496">                                x0 = (canvasBounds.width - GAP - legendWidth) + ((double) legendWidth / 3);</span>
<span class="source-line-no">497</span><span id="line.497">                                y0 = GAP + (double) LEGEND_LINE_GAP * (i + 1);</span>
<span class="source-line-no">498</span><span id="line.498">                                g.drawLine((int) x0, (int) y0, (int) x0 + LEGEND_LINE_WIDTH, (int) y0);</span>
<span class="source-line-no">499</span><span id="line.499">                                g.drawString(lineLabels[i], (int) x0 + 10, (int) y0 + 3);</span>
<span class="source-line-no">500</span><span id="line.500">                            }</span>
<span class="source-line-no">501</span><span id="line.501">                        }</span>
<span class="source-line-no">502</span><span id="line.502"></span>
<span class="source-line-no">503</span><span id="line.503">                        // draw a box on the legend</span>
<span class="source-line-no">504</span><span id="line.504">                        if ((lineLabels != null) &amp;&amp; (lineLabels.length &gt;= numberOfLines)) {</span>
<span class="source-line-no">505</span><span id="line.505">                            g.setForeground(Display.getCurrent().getSystemColor(SWT.COLOR_BLACK));</span>
<span class="source-line-no">506</span><span id="line.506">                            g.drawRectangle(canvasBounds.width - legendWidth - GAP, GAP, legendWidth, legendHeight);</span>
<span class="source-line-no">507</span><span id="line.507">                        }</span>
<span class="source-line-no">508</span><span id="line.508"></span>
<span class="source-line-no">509</span><span id="line.509">                        g.setForeground(c); // set the color back to its default</span>
<span class="source-line-no">510</span><span id="line.510">                    } //  (chartStyle == LINEPLOT)</span>
<span class="source-line-no">511</span><span id="line.511">                    else if (chartStyle == HISTOGRAM) {</span>
<span class="source-line-no">512</span><span id="line.512">                        // draw histogram for selected image area</span>
<span class="source-line-no">513</span><span id="line.513">                        xp = xgap;</span>
<span class="source-line-no">514</span><span id="line.514">                        int barHeight = 0;</span>
<span class="source-line-no">515</span><span id="line.515">                        g.setBackground(barColor);</span>
<span class="source-line-no">516</span><span id="line.516">                        int barWidth = plotWidth / numberOfPoints;</span>
<span class="source-line-no">517</span><span id="line.517">                        if (barWidth &lt;= 0)</span>
<span class="source-line-no">518</span><span id="line.518">                            barWidth = 1;</span>
<span class="source-line-no">519</span><span id="line.519">                        dw = (double) plotWidth / (double) numberOfPoints;</span>
<span class="source-line-no">520</span><span id="line.520">                        for (int j = 0; j &lt; numberOfPoints; j++) {</span>
<span class="source-line-no">521</span><span id="line.521">                            xp = xgap + j * dw;</span>
<span class="source-line-no">522</span><span id="line.522">                            barHeight = (int) (data[0][j] * (plotHeight / (ymax - ymin)));</span>
<span class="source-line-no">523</span><span id="line.523">                            g.fillRectangle((int) xp, ygap - barHeight, barWidth, barHeight);</span>
<span class="source-line-no">524</span><span id="line.524">                        }</span>
<span class="source-line-no">525</span><span id="line.525"></span>
<span class="source-line-no">526</span><span id="line.526">                        g.setBackground(c); // set the color back to its default</span>
<span class="source-line-no">527</span><span id="line.527">                    } // (chartStyle == HISTOGRAM)</span>
<span class="source-line-no">528</span><span id="line.528">                }</span>
<span class="source-line-no">529</span><span id="line.529">            });</span>
<span class="source-line-no">530</span><span id="line.530">        }</span>
<span class="source-line-no">531</span><span id="line.531">    }</span>
<span class="source-line-no">532</span><span id="line.532">}</span>




























































</pre>
</div>
</main>
</body>
</html>
